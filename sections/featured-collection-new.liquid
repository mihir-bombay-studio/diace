{{ 'featured-collection-new.css' | asset_url | stylesheet_tag }}

{% assign product_handle = section.settings.featured_collection %}

<div class="featured-collection-wrapper container">
  <h2 class="featured-collection-heading yellow-text bold">{{ section.settings.featured_collection_title }}</h2>
  <div class="featured-collection-desc semibold">{{ section.settings.featured_collection_desc }}</div>
  
  <div class="featured-products flex-box justify-between">
  	{% for product in collections[product_handle].products limit: 3 %}
    <div class="featured-product-card">
      <div class="featured-product-img rel">
    	<img class="product-img" src="{{ product.featured_image.src | img_url: 'x282' }}">
        <div class="fp-hover-text flex-box align-center">
          <span class="plus-icon">{% include 'icon-yellow-plus' %}</span>
          <a href="" class="hover-text bold">KOPEN</a>
        </div>
      </div>
      <div class="product-title-price flex-box justify-between">
      	<div class="product-title semibold">{{ product.title | escape  }}</div>
        <div class="product-compare-to-and-price">
          <span class="compare-to-price light">{{ product.compare_at_price | money }}</span>
          <span class="product-price semibold{% if product.compare_at_price %} yellow-text{% endif %}">{{ product.price | money }}</span>
        </div>
      </div>
      <div class="product-colors flex-box justify-between light">
          <div class="product-color">
            <span>Kleur: </span>
            <span>
               Paars
            </span>
          </div>
          <div class="other-available-colors">
            <a class="featured-product-link" href="{{ product.url }}">Meer kleuren beschikbaar</a>
          </div>
        </div>
        
    </div>
    {% endfor %}
  </div>
  
  {% for block in section.blocks %}
  {% if block.type == "button" %}
  {%- if block.settings.button_label != blank -%}
  <a href="{{ block.settings.button_link }}" class="btn center-it {% if block.settings.button-color == 'grey' %}btn-grey{% else %}btn-yellow{% endif %}">{{ block.settings.button_label | escape }}</a>
  {%- endif -%}
  {% endif %}
  {% endfor %}
</div>


<div class="product-recommendations" data-product-id="{{ product.id }}" data-limit="4">
  {%- if recommendations.products_count > 0 -%}
    <h2>You may also like</h2>
    <ul>
      {%- for product in recommendations.products -%}
      <li class="product">
        <a href="{{ product.url }}">
          <img class="product__img" src="{{ product.featured_image | img_url: '300x300' }}" alt="{{ product.featured_image.alt }}" />
          <p class="product__title">{{ product.title }}</p>
          <p class="product__price">{{ product.price | money}}</p>
        </a>
      </li>
      {%- endfor -%}
    </ul>
  {%- endif -%}
</div>

{% schema %}
  {
    "name": "Featured Collection",
    "settings": [
		{
          "type": "text",
          "id": "featured_collection_title",
          "label": "Featured Collection Title"
        },
		{
          "type": "text",
          "id": "featured_collection_desc",
          "label": "Featured Collection Desc"
        },
		{
          "type": "collection",
          "id": "featured_collection",
          "label": "Featured Collection"
        }
	],
	"blocks": [
	{
          "type": "button",
          "name": "Button",
          "limit": 1,
          "settings": [
            {
              "type": "text",
              "id": "button_label",
              "default": "Button label",
              "label": "t:sections.image-with-text.blocks.button.settings.button_label.label",
              "info": "t:sections.image-with-text.blocks.button.settings.button_label.info"
            },
            {
              "type": "url",
              "id": "button_link",
              "label": "t:sections.image-with-text.blocks.button.settings.button_link.label"
            },
            {
              "type": "select",
              "id": "button-color",
              "options": [
                {
                  "value": "grey",
                  "label": "Grey"
                },
                {
                  "value": "yellow",
                  "label": "Yellow"
                }
              ],
              "default": "grey",
              "label": "Grey"
            }
          ]
        }
  ],
  "presets": [
    {
      "name": "Featured Collection",
		"category":"section"
    }
  ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}


<script>
var loadProductRecommendationsIntoSection = function() {
  // Look for an element with class 'product-recommendations'
  var productRecommendationsSection = document.querySelector(".product-recommendations");
  if (productRecommendationsSection === null) { return; }
  // Read product id from data attribute
  var productId = productRecommendationsSection.dataset.productId;
  // Read limit from data attribute
  var limit = productRecommendationsSection.dataset.limit;
  // Build request URL
  var requestUrl = "/recommendations/products?section_id=product-recommendations&limit="+limit+"&product_id="+productId;
  // Create request and submit it using Ajax
  var request = new XMLHttpRequest();
  request.open("GET", requestUrl);
  request.onload = function() {
    if (request.status >= 200 && request.status < 300) {
      var container = document.createElement("div");
      container.innerHTML = request.response;
      productRecommendationsSection.parentElement.innerHTML = container.querySelector(".product-recommendations").innerHTML;
    }
  };
  request.send();
};
// If your section has theme settings, the theme editor
// reloads the section as you edit those settings. When that happens, the
// recommendations need to be fetched again.
// See https://help.shopify.com/en/themes/development/sections/integration-with-theme-editor
document.addEventListener("shopify:section:load", function(event) {
  if (event.detail.sectionId === "product-recommendations") {
    loadProductRecommendationsIntoSection();
  }
});
// Fetching the recommendations on page load
loadProductRecommendationsIntoSection();
</script>
