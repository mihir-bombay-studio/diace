class CollectionFiltersForm extends HTMLElement{constructor(){super();this.filterData=[];this.onActiveFilterClick=this.onActiveFilterClick.bind(this);this.debouncedOnSubmit=debounce(a=>{this.onSubmitHandler(a)},500);this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this));window.addEventListener("popstate",this.onHistoryChange.bind(this));this.bindActiveFacetButtonEvents()}onSubmitHandler(a){a.preventDefault();var b=new FormData(a.target.closest("form"));b=(new URLSearchParams(b)).toString();
this.renderPage(b,a)}onActiveFilterClick(a){a.preventDefault();this.toggleActiveFacets();this.renderPage((new URL(a.target.href)).searchParams.toString())}onHistoryChange(a){this.renderPage(a.state?.searchParams||"",null,!1)}toggleActiveFacets(a=!0){document.querySelectorAll(".js-facet-remove").forEach(b=>{b.classList.toggle("disabled",a)})}renderPage(a,b,c=!0){const d=this.getSections();document.getElementById("CollectionProductGrid").querySelector(".collection").classList.add("loading");d.forEach(f=>
{const e=`${window.location.pathname}?section_id=${f.section}&${a}`,g=h=>h.url===e;this.filterData.some(g)?this.renderSectionFromCache(g,f,b):this.renderSectionFromFetch(e,f,b)});c&&this.updateURLHash(a)}renderSectionFromFetch(a,b,c){fetch(a).then(d=>d.text()).then(d=>{this.filterData=[...this.filterData,{html:d,url:a}];this.renderFilters(d,c);this.renderProductGrid(d)})}renderSectionFromCache(a,b,c){a=this.filterData.find(a).html;this.renderFilters(a,c);this.renderProductGrid(a)}renderProductGrid(a){a=
(new DOMParser).parseFromString(a,"text/html").getElementById("CollectionProductGrid").innerHTML;document.getElementById("CollectionProductGrid").innerHTML=a}renderFilters(a,b){a=(new DOMParser).parseFromString(a,"text/html");var c=a.querySelectorAll("#CollectionFiltersForm .js-filter, #CollectionFiltersFormMobile .js-filter");const d=e=>e.dataset.index===b?.target.closest(".js-filter")?.dataset.index,f=Array.from(c).filter(e=>!d(e));c=Array.from(c).find(d);f.forEach(e=>{document.querySelector(`.js-filter[data-index="${e.dataset.index}"]`).innerHTML=
e.innerHTML});this.renderActiveFacets(a);this.renderMobileElements(a);c&&this.renderCounts(c,b.target.closest(".js-filter"))}renderActiveFacets(a){[".active-facets-mobile",".active-facets-desktop"].forEach(b=>{const c=a.querySelector(b);c&&(document.querySelector(b).innerHTML=c.innerHTML)});this.bindActiveFacetButtonEvents();this.toggleActiveFacets(!1)}renderMobileElements(a){[".mobile-facets__open",".mobile-facets__count"].forEach(b=>{document.querySelector(b).innerHTML=a.querySelector(b).innerHTML});
document.getElementById("CollectionFiltersFormMobile").closest("menu-drawer").bindEvents()}renderCounts(a,b){[".count-bubble",".facets__selected"].forEach(c=>{const d=b.querySelector(c);a.querySelector(c)&&d&&(b.querySelector(c).outerHTML=a.querySelector(c).outerHTML)})}bindActiveFacetButtonEvents(){document.querySelectorAll(".js-facet-remove").forEach(a=>{a.addEventListener("click",this.onActiveFilterClick,{once:!0})})}updateURLHash(a){history.pushState({searchParams:a},"",`${window.location.pathname}${a&&
"?".concat(a)}`)}getSections(){return[{id:"main-collection-product-grid",section:document.getElementById("main-collection-product-grid").dataset.id}]}}customElements.define("collection-filters-form",CollectionFiltersForm);
class PriceRange extends HTMLElement{constructor(){super();this.querySelectorAll("input").forEach(a=>a.addEventListener("change",this.onRangeChange.bind(this)));this.setMinAndMaxValues()}onRangeChange(a){this.adjustToValidValues(a.currentTarget);this.setMinAndMaxValues()}setMinAndMaxValues(){var a=this.querySelectorAll("input");const b=a[0];a=a[1];a.value&&b.setAttribute("max",a.value);b.value&&a.setAttribute("min",b.value);""===b.value&&a.setAttribute("min",0);""===a.value&&b.setAttribute("max",
a.getAttribute("max"))}adjustToValidValues(a){const b=Number(a.value),c=Number(a.getAttribute("min")),d=Number(a.getAttribute("max"));b<c&&(a.value=c);b>d&&(a.value=d)}}customElements.define("price-range",PriceRange);
